<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>猜他大爷</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no" />
    <meta name="format-detection" content="telephone=no,email=no" />
    <link rel="stylesheet" href="./index.css">
    <script src='./draw/js/jq.js'></script>
</head>

<body>
    <canvas id="canvas"></canvas>
    <div id='colors'></div>
    <div id='lineWidthBox'></div>
    <div id="chatArea">
        <div id="chatBox"></div>
    </div>
    <input id="message" placeholder="发送消息" />
    <button id="sendBtn">发送</button>
    <script>
        function getDom(id) {
            return document.getElementById(id);
        }
        let degree = 0;
        // setInterval(function () {
        //     degree += 3;
        //     document.body.style.background = `linear-gradient(${degree}deg, rgb(198, 255, 221), rgb(251, 215, 134), rgb(247, 121, 125))`;
        // }, 33);

        var canvas = getDom('canvas'),
            ctx = canvas.getContext('2d');
        canvas.width = document.documentElement.offsetWidth;
        canvas.height = document.documentElement.offsetHeight / 2;
        ctx.lineCap="round";
        ctx.lineJoin="round";
        const colors = [
            '#ffcef3',
            '#a1eafb',
            '#fff591',
            '#f26d5b',
            '#2f89fc'
        ];

        const lineWidth = [
            10,
            15,
            20,
            30,
            40
        ];
        ctx.lineWidth = lineWidth[0];
        ctx.strokeStyle = colors[0];

        colors.forEach(function (color) {
            $('#colors').append($('<div class="colorBlock">').css({
                backgroundColor: color
            }));
        });

        let colorIndex = 0;
        lineWidth.forEach(function (line, index) {
            $('#lineWidthBox').append($('<div class="lineBlock">').css({
                width: line,
                height: line,
                backgroundColor: colors[colorIndex]
            }));
        });


        $('#colors').on('click', '.colorBlock' ,function(e) {
            $(this).siblings().removeClass('active');
            $(this).addClass('active');
            colorIndex = $(this).index();
            ctx.strokeStyle = colors[$(this).index()];
            $('.lineBlock').css({
                backgroundColor: colors[colorIndex]
            })
        });


        $('#lineWidthBox').on('click', '.lineBlock' ,function(e) {
            $(this).siblings().removeClass('active');
            $(this).addClass('active');
            ctx.lineWidth = lineWidth[$(this).index()];
        });

        $('#sendBtn').on('click', function() {
            let li = $('<div class="chatItem">');
            li.append($('<span class="nickname">某某：</span>'));
            li.append($('<p class="chatItem_message">').html($('#message').val()));
            $('#chatBox').append(li);
            $('#chatArea').scrollTop($('#chatBox').height());
        });

        
        let isDrawing = false;

        let startX = 0, startY = 0;
        canvas.addEventListener('touchstart', function (e) {
            var touchPort = e.touches[0];

            var mouseX
            startX = touchPort.pageX;
            startY = touchPort.pageY;
            isDrawing = true;
            ctx.beginPath();
            ctx.moveTo(startX, startY);
        }, false);

        canvas.addEventListener('touchmove', function (e) {
            if (isDrawing) {
                let touchPort = e.touches[0];
                ctx.moveTo(startX, startY);
                ctx.lineTo(touchPort.pageX, touchPort.pageY);
                ctx.closePath();
                ctx.stroke();
                startX = touchPort.pageX;
                startY = touchPort.pageY;
            }
        }, false);

        canvas.addEventListener('touchend', function(e) {
            isDrawing = false;
        });

    </script>
</body>

</html>